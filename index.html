<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BGU Mobility Survey - Interactive POI Map</title>
    <link rel="icon" href="assets/media/favicon.ico" sizes="any" />
    <link
      rel="shortcut icon"
      href="assets/media/favicon.ico"
      type="image/x-icon"
    />

    <!-- MapLibre GL JS -->
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link
      href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css"
      rel="stylesheet"
    />

    <!-- deck.gl -->
    <script src="https://unpkg.com/deck.gl@^9.0.0/dist.min.js"></script>

    <!-- Inter Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: #f5f5f5;
        color: #333333;
        overflow: hidden;
        height: 100vh;
      }

      .info-btn {
        width: 100%;
        height: 40px;
        background: linear-gradient(
          135deg,
          rgba(100, 255, 218, 0.2),
          rgba(0, 188, 212, 0.1)
        );
        backdrop-filter: blur(15px);
        border: 2px solid rgba(100, 255, 218, 0.3);
        border-radius: 12px;
        color: #64ffda;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        box-shadow: 0 4px 15px rgba(100, 255, 218, 0.2);
        margin-top: 12px;
      }

      .info-btn:hover {
        background: linear-gradient(
          135deg,
          rgba(100, 255, 218, 0.3),
          rgba(0, 188, 212, 0.2)
        );
        border-color: rgba(100, 255, 218, 0.5);
        color: #ffffff;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(100, 255, 218, 0.3);
      }

      #map {
        width: 100vw;
        height: 100vh;
        position: relative;
        top: 0;
      }

      /* Smooth transitions for map layers */
      .maplibregl-map .maplibregl-canvas {
        transition: filter 0.2s ease;
      }

      /* Enhanced rendering for smooth overlapping lines */
      .maplibregl-map {
        image-rendering: auto;
        image-rendering: -webkit-optimize-contrast;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* Force hardware acceleration for smoother rendering */
      .maplibregl-canvas {
        will-change: transform;
        transform: translateZ(0);
      }

      /* Glass Panel Base - Dark Mode */
      .ui-panel {
        position: absolute;
        background: linear-gradient(
          135deg,
          rgba(15, 18, 20, 0.85),
          rgba(20, 22, 24, 0.75)
        );
        backdrop-filter: blur(18px) saturate(140%);
        -webkit-backdrop-filter: blur(18px) saturate(140%);
        border: 1px solid rgba(255, 255, 255, 0.16);
        border-radius: 18px;
        padding: 20px;
        z-index: 1000;
        transition: background 0.3s ease, transform 0.3s ease,
          border-color 0.3s ease, box-shadow 0.3s ease;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.45),
          inset 0 1px 0 rgba(255, 255, 255, 0.06);
      }

      .ui-panel:hover {
        background: linear-gradient(
          135deg,
          rgba(15, 18, 20, 0.9),
          rgba(20, 22, 24, 0.8)
        );
        transform: translateY(-2px);
        border-color: rgba(255, 255, 255, 0.22);
        box-shadow: 0 14px 48px rgba(0, 0, 0, 0.5),
          inset 0 1px 0 rgba(255, 255, 255, 0.08);
      }

      /* Title Section */
      .title-section {
        margin-bottom: 20px;
      }

      .project-title {
        background: linear-gradient(135deg, #64ffda, #00bcd4);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 28px;
        text-align: center;
        font-weight: 700;
        letter-spacing: 0.5px;
        text-shadow: 0 2px 4px rgba(100, 255, 218, 0.2);
        position: relative;
        margin: 0;
      }

      .project-title::after {
        content: "";
        position: absolute;
        bottom: -4px;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, #64ffda, transparent);
        border-radius: 1px;
      }

      /* Logo Section in Control Panel */
      .logo-section {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-top: 12px;
        justify-content: center;
      }

      .logo-section .logo-item {
        display: flex;
        align-items: center;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .logo-section .logo-item:hover {
        transform: scale(1.05);
      }

      .logo-section .logo-item img {
        height: 40px;
        width: auto;
        object-fit: contain;
      }

      .logo-section .logo-item.nur img {
        height: 35px;
        filter: brightness(0) invert(1); /* Make NUR logo white */
      }

      .logo-section .logo-item.zencity img {
        height: 45px;
        /* Preserve ZenCity logo colors - no filter */
      }

      /* Combined Info & Controls Panel */
      .info-controls-panel {
        top: 5px;
        left: 5px;
        max-width: 360px;
      }

      .panel-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 16px;
        color: #ffffff;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .info-section {
        margin-bottom: 15px;
      }

      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 14px;
      }

      .info-item {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 12px;
        padding: 12px;
        text-align: center;
      }

      .info-number {
        font-size: 24px;
        font-weight: 700;
        color: #64ffda;
        display: block;
        margin-bottom: 4px;
      }

      .info-label {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.7);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 500;
      }

      /* Gradient Legend */
      .legend-gradient {
        margin-bottom: 16px;
      }

      .gradient-bar {
        height: 20px;
        background: linear-gradient(
          to right,
          #004d00,
          #006400,
          #228b22,
          #32cd32,
          #90ee90
        );
        border-radius: 10px;
        margin-bottom: 8px;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .gradient-labels {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.9);
      }

      /* Legend Section in Control Panel */
      .legend-section {
        margin-bottom: 20px;
        padding-bottom: 16px;
        position: relative;
      }

      .legend-section::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, #64ffda, transparent);
        border-radius: 1px;
      }

      .legend-section h3 {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 12px;
        color: rgba(255, 255, 255, 0.95);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .legend-items {
        display: flex;
        align-items: center;
        flex-direction: column;
        gap: 6px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: rgba(255, 255, 255, 0.95);
        font-weight: 500;
      }

      .legend-color {
        width: 16px;
        height: 8px;
        border-radius: 2px;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .legend-label {
        flex: 1;
      }

      /* Map Controls - Improved Vertical Stack */
      .map-controls {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 1001;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .map-control-btn {
        width: 40px;
        height: 40px;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        color: rgba(255, 255, 255, 0.95);
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .map-control-btn:hover {
        background: rgba(0, 0, 0, 0.9);
        transform: translateY(-1px);
      }

      /* MapLibre Controls Styling - In Same Container */
      .maplibregl-ctrl-top-right {
        position: static !important;
        margin: 0 !important;
      }

      .maplibregl-ctrl-bottom-right {
        bottom: 20px !important;
        right: 20px !important;
      }

      .maplibregl-ctrl-group {
        background: rgba(0, 0, 0, 0.8) !important;
        backdrop-filter: blur(20px) !important;
        -webkit-backdrop-filter: blur(20px) !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        border-radius: 12px !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3) !important;
        width: 40px !important;
        margin-bottom: 8px !important;
      }

      /* Remove margin when MapLibre controls are inside our container */
      .map-controls .maplibregl-ctrl-group {
        margin-bottom: 0 !important;
        margin-top: 0 !important;
      }

      .maplibregl-ctrl-group button {
        background: transparent !important;
        border: none !important;
        color: rgba(255, 255, 255, 0.95) !important;
        transition: all 0.3s ease !important;
        width: 40px !important;
        height: 40px !important;
      }

      .maplibregl-ctrl-group button:hover {
        background: rgba(255, 255, 255, 0.1) !important;
        color: #ffffff !important;
        transform: translateY(-1px) !important;
      }

      /* Enhance compass visibility on dark background */
      .maplibregl-ctrl-bottom-right .maplibregl-ctrl-group.compass-group {
        background: rgba(0, 0, 0, 0.9) !important;
        border: 1px solid rgba(100, 255, 218, 0.35) !important;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.45),
          0 0 0 1px rgba(100, 255, 218, 0.1) inset !important;
      }
      .maplibregl-ctrl-bottom-right
        .maplibregl-ctrl-group.compass-group
        .maplibregl-ctrl-icon {
        filter: invert(1) brightness(1.4)
          drop-shadow(0 0 4px rgba(100, 255, 218, 0.45)) !important;
      }
      .maplibregl-ctrl-bottom-right
        .maplibregl-ctrl-group.compass-group
        button:hover {
        background: rgba(100, 255, 218, 0.12) !important;
      }

      /* Simple filter approach for MapLibre control icons - inverts them to white */
      .maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon,
      .maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon,
      .maplibregl-ctrl-compass .maplibregl-ctrl-icon {
        filter: invert(1) brightness(1.2) !important;
      }

      .maplibregl-ctrl-group button:first-child {
        border-top-left-radius: 12px !important;
        border-top-right-radius: 12px !important;
      }

      .maplibregl-ctrl-group button:last-child {
        border-bottom-left-radius: 12px !important;
        border-bottom-right-radius: 12px !important;
      }

      .maplibregl-ctrl-scale {
        background: rgba(0, 0, 0, 0.8) !important;
        backdrop-filter: blur(20px) !important;
        -webkit-backdrop-filter: blur(20px) !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        border-radius: 8px !important;
        color: rgba(255, 255, 255, 0.95) !important;
        padding: 4px 8px !important;
        font-size: 13px !important;
        font-family: "Inter", sans-serif !important;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important;
      }

      /* Loading Overlay */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.5s ease;
      }

      .loading-content {
        text-align: center;
        color: #ffffff;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top: 3px solid #64ffda;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Analysis Links */
      .analysis-links {
        margin-top: 16px;
      }

      .analysis-links h3 {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 12px;
        color: rgba(255, 255, 255, 0.95);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .analysis-btn {
        display: block;
        width: 100%;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        color: rgba(255, 255, 255, 0.95);
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: left;
        margin-bottom: 6px;
        text-decoration: none;
      }

      .analysis-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateX(2px);
      }

      /* Narrative style for Analysis section */
      .analysis-narrative {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.92);
        line-height: 1.6;
      }

      .analysis-narrative a {
        color: #64ffda;
        font-weight: 600;
        text-decoration: none;
        border-bottom: 1px dashed rgba(100, 255, 218, 0.6);
        transition: color 0.2s ease, border-color 0.2s ease;
      }

      .analysis-narrative a:hover {
        color: #ffffff;
        border-bottom-color: #ffffff;
      }

      /* Add spacing between narrative bullet points */
      .analysis-narrative li {
        margin-bottom: 10px;
      }
      .analysis-narrative li:last-child {
        margin-bottom: 0;
      }

      /* Info Modal */
      .info-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        backdrop-filter: blur(5px);
      }

      .info-modal.show {
        display: flex;
      }

      .info-modal-content {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.95),
          rgba(240, 250, 255, 0.9)
        );
        backdrop-filter: blur(20px);
        border: 2px solid rgba(100, 255, 218, 0.3);
        border-radius: 20px;
        padding: 40px;
        max-width: 400px;
        text-align: center;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        position: relative;
      }

      .info-modal-close {
        position: absolute;
        top: 15px;
        right: 20px;
        width: 30px;
        height: 30px;
        background: rgba(100, 255, 218, 0.2);
        border: none;
        border-radius: 50%;
        color: #333;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      .info-modal-close:hover {
        background: rgba(100, 255, 218, 0.3);
        transform: scale(1.1);
      }

      .info-modal h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 24px;
        background: linear-gradient(135deg, #64ffda, #00bcd4);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .info-modal p {
        color: #666;
        font-size: 16px;
        line-height: 1.6;
      }

      /* Popup Styling */
      .poi-popup,
      .gate-popup,
      .route-popup {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        padding: 16px;
        color: #333;
        font-family: "Inter", sans-serif;
        max-width: 250px;
      }

      .poi-popup h4,
      .gate-popup h4,
      .route-popup h4 {
        color: #2c3e50;
        margin: 0 0 8px 0;
        font-size: 14px;
        font-weight: 600;
      }

      .poi-comment {
        color: #666;
        font-style: italic;
        margin: 0;
        font-size: 12px;
      }

      .mode-pie-chart {
        margin-top: 8px;
      }

      .mode-item {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 4px;
        font-size: 13px;
      }

      .mode-color {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 1px solid rgba(0, 0, 0, 0.1);
      }

      .route-mode-item {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 4px;
        font-size: 13px;
      }

      .mode-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        border: 1px solid rgba(0, 0, 0, 0.1);
      }

      /* Analysis Module Popup Fixes */
      .maplibregl-popup-content {
        background: rgba(255, 255, 255, 0.95) !important;
        backdrop-filter: blur(20px) !important;
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
        border-radius: 12px !important;
        color: #333 !important;
        font-family: "Inter", sans-serif !important;
      }

      .maplibregl-popup-tip {
        background: rgba(255, 255, 255, 0.95) !important;
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
      }

      /* Deck.gl Tooltip Styling */
      .deck-tooltip {
        font-family: "Inter", sans-serif !important;
        z-index: 1000 !important;
        pointer-events: none !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
      }

      /* Deck.gl Widget Styling */
      .deck-widget,
      [class*="deck-"] {
        background: rgba(0, 0, 0, 0.8) !important;
        backdrop-filter: blur(20px) !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        border-radius: 12px !important;
        color: rgba(255, 255, 255, 0.95) !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
        font-family: "Inter", sans-serif !important;
      }

      /* Ensure deck.gl controls are positioned correctly */
      .maplibregl-map .deck-widget {
        position: absolute !important;
        z-index: 1000 !important;
      }

      /* Style deck.gl control buttons */
      .deck-widget button,
      [class*="deck-"] button {
        background: transparent !important;
        border: none !important;
        color: rgba(255, 255, 255, 0.95) !important;
        transition: all 0.3s ease !important;
        border-radius: 8px !important;
        padding: 4px !important;
      }

      .deck-widget button:hover,
      [class*="deck-"] button:hover {
        background: rgba(255, 255, 255, 0.1) !important;
        color: #ffffff !important;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .project-title {
          font-size: 18px;
          letter-spacing: 0.3px;
        }

        .ui-panel {
          border-radius: 14px;
          padding: 12px;
        }

        .info-controls-panel {
          top: 12px;
          left: 5px;
          max-width: 300px;
          max-height: 45vh;
          overflow-y: auto;
        }

        .legend-section h3,
        .panel-title {
          font-size: 14px;
          margin-bottom: 10px;
        }

        .legend-items {
          gap: 4px;
        }
        .legend-item {
          font-size: 11px;
          gap: 6px;
        }
        .legend-color {
          width: 12px;
          height: 6px;
        }
        .gradient-bar {
          height: 14px;
        }
        .gradient-labels {
          font-size: 9px;
        }

        .analysis-links h3 {
          font-size: 14px;
        }
        .analysis-narrative {
          font-size: 11px;
        }
        .analysis-btn {
          font-size: 10px;
          padding: 6px 10px;
        }

        .info-btn {
          height: 34px;
          font-size: 12px;
          border-radius: 10px;
          margin-top: 8px;
        }

        .logo-section {
          margin-top: 12px;
          gap: 8px;
        }
        .logo-section .logo-item img {
          height: 24px;
        }
        .logo-section .logo-item.nur img {
          height: 20px;
        }
        .logo-section .logo-item.zencity img {
          height: 26px;
        }

        .info-item {
          padding: 10px;
        }
        .info-number {
          font-size: 16px;
        }
        .info-label {
          font-size: 10px;
        }
        .info-grid {
          grid-template-columns: 1fr;
          gap: 6px;
        }

        .map-controls {
          top: 12px;
          right: 12px;
          gap: 6px;
        }
        .map-control-btn {
          width: 34px;
          height: 34px;
          font-size: 16px;
          border-radius: 10px;
        }

        .maplibregl-ctrl-group {
          width: 34px !important;
          border-radius: 10px !important;
        }
        .maplibregl-ctrl-group button {
          width: 34px !important;
          height: 34px !important;
        }
        .maplibregl-ctrl-scale {
          font-size: 10px !important;
          padding: 3px 6px !important;
        }

        #map {
          height: 100vh;
          top: 0;
        }
      }

      @media (max-width: 480px) {
        .project-title {
          font-size: 16px;
        }

        .info-controls-panel {
          max-width: 300px;
          max-height: 40vh;
        }

        .legend-item {
          font-size: 10px;
        }
        .legend-color {
          width: 10px;
          height: 5px;
        }
        .gradient-bar {
          height: 12px;
        }
        .gradient-labels {
          font-size: 8px;
        }

        /* Keep findings visible on all screens; rely on panel scroll */

        .info-btn {
          height: 30px;
          font-size: 11px;
          margin-top: 8px;
        }

        .logo-section .logo-item img {
          height: 20px;
        }
        .logo-section .logo-item.nur img {
          height: 16px;
        }
        .logo-section .logo-item.zencity img {
          height: 22px;
        }

        .map-controls {
          top: 10px;
          right: 10px;
          gap: 6px;
        }
        .map-control-btn {
          width: 32px;
          height: 32px;
          font-size: 15px;
          border-radius: 10px;
        }
        .maplibregl-ctrl-group {
          width: 32px !important;
        }
        .maplibregl-ctrl-group button {
          width: 32px !important;
          height: 32px !important;
        }
        .maplibregl-ctrl-scale {
          font-size: 9px !important;
          padding: 2px 5px !important;
        }

        .info-modal-content {
          padding: 20px;
          max-width: 90vw;
        }
        .info-modal h2 {
          font-size: 20px;
        }
        .info-modal p {
          font-size: 14px;
        }

        #map {
          height: 100vh;
          top: 0;
        }
      }
    </style>
  </head>
  <body>
    <!-- Loading Overlay -->
    <div id="loading" class="loading-overlay">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <h2>Loading BGU Mobility Data...</h2>
        <p>Please wait while we prepare your interactive map</p>
      </div>
    </div>

    <!-- Map Container -->
    <div id="map"></div>

    <!-- Combined Info & Controls Panel -->
    <div class="ui-panel info-controls-panel">
      <!-- Title Section -->
      <div class="title-section">
        <h1 class="project-title">BGU Mobility Survey</h1>
      </div>

      <!-- Legend Section -->
      <div class="legend-section">
        <h3><i class="fas fa-layer-group"></i>Legend</h3>

        <div class="legend-items">
          <div class="legend-item">
            <div class="legend-color" style="background: #22a7f0"></div>
            <span class="legend-label">South Gate</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #9c5dc7"></div>
            <span class="legend-label">North Gate</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #e14b31"></div>
            <span class="legend-label">West Gate</span>
          </div>
          <div class="legend-item">
            <div
              style="
                width: 16px;
                height: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
              "
            >
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none">
                <path
                  d="M8 18L12 22L16 18"
                  stroke="#4CAF50"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M12 2V22"
                  stroke="#4CAF50"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </div>
            <span class="legend-label">POI Points</span>
          </div>
          <div class="legend-item">
            <div style="display: flex; gap: 4px; align-items: center">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none">
                <circle
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="#22a7f0"
                  stroke-width="2"
                />
                <circle
                  cx="12"
                  cy="12"
                  r="6"
                  stroke="#22a7f0"
                  stroke-width="2"
                />
                <circle cx="12" cy="12" r="2" fill="#22a7f0" />
              </svg>
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none">
                <circle
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="#9c5dc7"
                  stroke-width="2"
                />
                <circle
                  cx="12"
                  cy="12"
                  r="6"
                  stroke="#9c5dc7"
                  stroke-width="2"
                />
                <circle cx="12" cy="12" r="2" fill="#9c5dc7" />
              </svg>
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none">
                <circle
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="#e14b31"
                  stroke-width="2"
                />
                <circle
                  cx="12"
                  cy="12"
                  r="6"
                  stroke="#e14b31"
                  stroke-width="2"
                />
                <circle cx="12" cy="12" r="2" fill="#e14b31" />
              </svg>
            </div>
            <span class="legend-label">Gates</span>
          </div>
        </div>
      </div>

      <!-- Analysis Links -->
      <div class="analysis-links">
        <h3><i class="fas fa-chart-bar"></i>Findings</h3>
        <ul class="analysis-narrative">
          <li>
            For
            <a href="outputs/transport_modes_donut.html" target="_blank"
              >mode of travel</a
            >, almost two-thirds of students walk to BGU and only 5% drive
          </li>
          <li>
            Analysis of
            <a href="outputs/gate_distribution.html" target="_blank"
              >routes to the 3 gates</a
            >
            showed that half the students enter the northern Rager gate
          </li>
          <li>
            The most important
            <a href="outputs/route_choice_spider.html" target="_blank"
              >factor in choosing</a
            >
            a walking route was distance followed by shade
          </li>
          <li>
            <a href="outputs/walking_distance.html" target="_blank"
              >Route analysis</a
            >
            shows that on average, BGU students walk 0.95 KM on the way to
            campus
          </li>
          <li>
            <a href="outputs/distance_comparison.html" target="_blank"
              >Many students report</a
            >
            feeling far from campus even when living only a few hundred meters
            away!
          </li>
        </ul>

        <button
          class="info-btn"
          onclick="toggleInfoModal()"
          title="Information"
        >
          <i class="fas fa-info"></i> Information
        </button>
      </div>

      <!-- Logo Section -->
      <div class="logo-section">
        <div class="logo-item nur">
          <img src="assets/media/Nur Logo white.svg" alt="NUR Logo" />
        </div>
        <div class="logo-item zencity">
          <img src="assets/media/zencity white.svg" alt="ZenCity Logo" />
        </div>
      </div>
    </div>

    <!-- Map Controls - Improved Vertical Stack -->
    <div class="map-controls">
      <button
        class="map-control-btn"
        onclick="resetMap()"
        title="Reset Map View"
      >
        <i class="fas fa-home"></i>
      </button>
      <button
        class="map-control-btn"
        onclick="toggleFullscreen()"
        title="Toggle Fullscreen"
      >
        <i class="fas fa-expand"></i>
      </button>
      <!-- MapLibre controls will be moved here by JavaScript -->
      <div id="maplibre-controls-container"></div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="info-modal">
      <div class="info-modal-content">
        <button class="info-modal-close" onclick="toggleInfoModal()">
          <i class="fas fa-times"></i>
        </button>
        <h2>Information</h2>
        <p>TO BE WRITTEN</p>
      </div>
    </div>

    <!-- Map Controller Script -->
    <script src="assets/js/map-controller.js"></script>

    <script>
      // Info modal functionality
      function toggleInfoModal() {
        const modal = document.getElementById("infoModal");
        modal.classList.toggle("show");
      }

      // Close modal when clicking outside
      document
        .getElementById("infoModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            toggleInfoModal();
          }
        });

      // Close modal with escape key
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          const modal = document.getElementById("infoModal");
          if (modal.classList.contains("show")) {
            toggleInfoModal();
          }
        }
      });

      // Move MapLibre controls into the same container as custom controls
      function moveMapLibreControls() {
        const mapLibreControls = document.querySelector(
          ".maplibregl-ctrl-top-right"
        );
        const container = document.getElementById(
          "maplibre-controls-container"
        );

        if (mapLibreControls && container) {
          container.appendChild(mapLibreControls);
        } else {
          // Try again after a short delay if controls aren't ready yet
          setTimeout(moveMapLibreControls, 100);
        }
      }

      // Wait for the map to be initialized and controls to be created
      document.addEventListener("DOMContentLoaded", function () {
        // Give the map time to initialize
        setTimeout(moveMapLibreControls, 500);
      });
    </script>
  </body>
</html>
